链式求和（按论文的正确做法）

1) 目标函数的求和（按单元求和）
E = Σ_e ε_e^T C(θ_e) ε_e
先在每个单元上计算应变/刚度与能量，再对所有单元求和，不能把场量先混合后再统一代入。

2) 结点层链式求导的求和（只对被零水平集穿过的相邻单元求和）
Δφ_i ∝ Σ_{e∈N(i)} (∂E/∂θ_e)·(∂θ_e/∂φ_i)
N(i) 仅包含“与结点 i 相邻且被主路径（φ=0）穿过”的单元；不能把所有单元都加进来。

3) 单元内部对结点的求和（θ_e 对 φ_i 的导数计算）
先用形函数导数对 4 个结点求和得到梯度：
  ∂φ/∂x = Σ_k (∂N_k/∂x) φ_k ,  ∂φ/∂y = Σ_k (∂N_k/∂y) φ_k
θ_e = π/2 + atan2(∂φ/∂y, ∂φ/∂x)
对 φ_i 求导时要包含“除 i 外的其余结点”的求和项：
  P_i = Σ_{p≠i} (∂N_p/∂x) φ_p ,  Q_i = Σ_{q≠i} (∂N_q/∂y) φ_q
漏加或重复计入会引入噪声。

4) 单元灵敏度的求和结构（逐单元独立计算 ∂E/∂θ_e）
每个单元独立用其应变/应力、三角展开等求出 ∂E/∂θ_e，
只在结点层汇总时做 Σ_e，不要把不同单元的中间量（如 A1…A8）混合后再求。

5) 时间步长的“最大值”而非“求和”
Δt = Δθ_max / max_e |∂E/∂θ_e|
这里对 e 取最大值（CFL 限幅），若误写成 Σ 会导致不稳定与振荡。
